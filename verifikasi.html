<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Verifikasi QR Anggota SKH</title>

<script src="https://unpkg.com/html5-qrcode"></script>

<style>
body{
    font-family: Arial, sans-serif;
    background:#0f172a;
    color:white;
    text-align:center;
    padding:40px;
}
.box{
    background:#1e293b;
    padding:30px;
    border-radius:15px;
    max-width:500px;
    margin:auto;
    position:relative;
    overflow:hidden;
}
#reader{
    margin-top:20px;
}
.valid{ color:#22c55e; font-weight:bold; margin-top:20px;}
.invalid{ color:#ef4444; font-weight:bold; margin-top:20px;}
.flash{
    position:absolute;
    top:0;left:0;
    width:100%;height:100%;
    opacity:0;
    pointer-events:none;
}
.flash.green{ background:rgba(34,197,94,0.4);}
.flash.red{ background:rgba(239,68,68,0.4);}
</style>
</head>
<body>

<div class="box">
<h2>Scan QR Anggota</h2>

<button onclick="startScanner()">Aktifkan Kamera</button>
<div id="reader"></div>
<div id="hasil"></div>
<div class="flash" id="flash"></div>

</div>

<script>

const WEB_APP_URL = "https://script.google.com/macros/s/AKfycbxgBRf27sB3bMFNTTTfJ6ZGBAGe2xJ0Wn1cln5afaeUSL3Wcm4HMqHeSJFBU3yK60ik6A/exec";
let scanner;

function beep(freq,duration){
    const ctx=new(window.AudioContext||window.webkitAudioContext)();
    const osc=ctx.createOscillator();
    osc.frequency.value=freq;
    osc.connect(ctx.destination);
    osc.start();
    setTimeout(()=>osc.stop(),duration);
}

function vibrate(ms){
    if(navigator.vibrate) navigator.vibrate(ms);
}

function flash(color){
    const f=document.getElementById("flash");
    f.className="flash "+color;
    f.style.opacity=1;
    setTimeout(()=>f.style.opacity=0,400);
}

function startScanner(){
    scanner = new Html5Qrcode("reader");

    scanner.start(
        { facingMode: "environment" },
        { fps: 10, qrbox: 250 },
        async (decodedText) => {

            scanner.stop();

            const res=await fetch(WEB_APP_URL);
            const data=(await res.json()).data;

            const found=data.find(r=>r["No Anggota"]===decodedText && r.Status==="Aktif");

            if(found){
                document.getElementById("hasil").innerHTML="<div class='valid'>✅ VALID - AKTIF</div>";
                beep(1000,200);
                vibrate(200);
                flash("green");
            }else{
                document.getElementById("hasil").innerHTML="<div class='invalid'>❌ TIDAK VALID</div>";
                beep(250,400);
                vibrate(400);
                flash("red");
            }

        }
    );
}

</script>

</body>
</html>
