<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Admin Panel SKH</title>
<style>
body{font-family:Georgia,serif;background:#111;color:white;padding:40px}
.card{max-width:600px;margin:auto;background:#1e293b;padding:25px;border-radius:14px}
input,textarea{width:100%;padding:10px;margin:6px 0;border-radius:8px;border:none}
button{padding:10px 18px;border:none;border-radius:8px;background:#d4af37;color:black;font-weight:bold;cursor:pointer}
.logout{background:red;color:white;margin-top:10px}
</style>
</head>
<body>

<div class="card">
<h2>Tambah Koleksi Keris SKH</h2>

<input id="nomor" placeholder="Nomor Sertifikat">
<input id="nama" placeholder="Nama Pusaka">
<input id="jenis" placeholder="Jenis">
<input id="periode" placeholder="Periode">
<textarea id="deskripsi" placeholder="Deskripsi"></textarea>
<button onclick="simpan()">Simpan</button>
<button class="logout" onclick="logout()">Logout</button>
</div>

<script>

// ================= VALIDASI LOGIN =================
document.addEventListener("DOMContentLoaded", function(){

    const isLogin = localStorage.getItem("adminLogin");

    if(isLogin !== "true"){
        window.location.replace("index.html");
        return;
    }

    // ================= AUTO TIMEOUT 10 MENIT =================
    const timeoutDuration = 10 * 60 * 1000; // 10 menit

    function updateActivity(){
        localStorage.setItem("lastActivity", Date.now().toString());
    }

    function checkTimeout(){
        const lastActivity = localStorage.getItem("lastActivity");

        if(!lastActivity){
            updateActivity();
            return;
        }

        const selisih = Date.now() - parseInt(lastActivity);

        if(selisih > timeoutDuration){
            logout();
        }
    }

    function logout(){
        localStorage.removeItem("adminLogin");
        localStorage.removeItem("lastActivity");
        window.location.replace("index.html");
    }

    // reset timer saat ada aktivitas
    document.addEventListener("click", updateActivity);
    document.addEventListener("mousemove", updateActivity);
    document.addEventListener("keydown", updateActivity);

    // set awal aktivitas
    updateActivity();

    // cek tiap 5 detik
    setInterval(checkTimeout, 5000);

    // ================= DATABASE =================
    window.getDB = function(){
        return JSON.parse(localStorage.getItem("koleksiSKH") || "[]");
    }

    window.setDB = function(data){
        localStorage.setItem("koleksiSKH", JSON.stringify(data));
    }

    window.simpan = function(){
        let db = getDB();

        let nomor = document.getElementById("nomor").value;
        let nama = document.getElementById("nama").value;
        let jenis = document.getElementById("jenis").value;
        let periode = document.getElementById("periode").value;
        let deskripsi = document.getElementById("deskripsi").value;

        if(!nomor || !nama){
            alert("Nomor dan Nama wajib diisi!");
            return;
        }

        if(db.find(d => d.nomor === nomor)){
            alert("Nomor sudah ada!");
            return;
        }

        db.push({nomor,nama,jenis,periode,deskripsi});
        setDB(db);

        alert("Data tersimpan!");

        document.getElementById("nomor").value="";
        document.getElementById("nama").value="";
        document.getElementById("jenis").value="";
        document.getElementById("periode").value="";
        document.getElementById("deskripsi").value="";

        updateActivity();
    }

    window.logout = logout;

});

</script>

</body>
</html>
