<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Admin Panel SKH</title>

<style>
body{
    font-family:Georgia,serif;
    background:#111;
    color:white;
    padding:40px;
}
.card{
    max-width:700px;
    margin:auto;
    background:#1e293b;
    padding:25px;
    border-radius:14px;
}
input,textarea{
    width:100%;
    padding:10px;
    margin:6px 0;
    border-radius:8px;
    border:none;
}
button{
    padding:10px 18px;
    border:none;
    border-radius:8px;
    background:#d4af37;
    color:black;
    font-weight:bold;
    cursor:pointer;
    margin-top:5px;
}
.logout{
    background:red;
    color:white;
}
.preview{
    margin-top:10px;
    text-align:center;
}
.preview img{
    max-width:200px;
    border-radius:10px;
    margin-top:10px;
    border:2px solid gold;
}
.list{
    margin-top:30px;
}
.item{
    background:#0f172a;
    padding:10px;
    border-radius:10px;
    margin-bottom:10px;
}
.item img{
    width:80px;
    height:80px;
    object-fit:cover;
    border-radius:8px;
    margin-right:10px;
}
.flex{
    display:flex;
    align-items:center;
}
.hapus{
    background:red;
    color:white;
    padding:5px 10px;
    border-radius:6px;
    margin-left:auto;
}
</style>
</head>
<body>

<div class="card">
<h2>Tambah Koleksi Pusaka SKH</h2>

<input id="nomor" placeholder="Nomor Sertifikat">
<input id="nama" placeholder="Nama Pusaka">
<input id="pemilik" placeholder="Pemilik">
<input id="jenis" placeholder="Jenis">
<input id="periode" placeholder="Periode">
<textarea id="deskripsi" placeholder="Deskripsi"></textarea>
<input type="file" id="foto" accept="image/*">

<div class="preview" id="preview"></div>

<button onclick="simpan()">Simpan</button>
<button class="logout" onclick="logout()">Logout</button>

<div class="list" id="daftarKoleksi"></div>

</div>

<script>

//////////////////////////////////////////////////
// VALIDASI LOGIN
//////////////////////////////////////////////////

if(localStorage.getItem("adminLogin") !== "true"){
    window.location.replace("index.html");
}

//////////////////////////////////////////////////
// DATABASE (UNTUK GALERI)
//////////////////////////////////////////////////

function getDB(){
    return JSON.parse(localStorage.getItem("dataPusaka") || "[]");
}

function setDB(data){
    localStorage.setItem("dataPusaka", JSON.stringify(data));
}

//////////////////////////////////////////////////
// PREVIEW FOTO
//////////////////////////////////////////////////

document.getElementById("foto").addEventListener("change", function(){
    const file = this.files[0];
    if(!file) return;

    const reader = new FileReader();
    reader.onload = function(e){
        document.getElementById("preview").innerHTML =
        `<img src="${e.target.result}">`;
    };
    reader.readAsDataURL(file);
});

//////////////////////////////////////////////////
// SIMPAN DATA
//////////////////////////////////////////////////

function simpan(){

    let db = getDB();

    let nomor = document.getElementById("nomor").value.trim();
    let nama = document.getElementById("nama").value.trim();
    let pemilik = document.getElementById("pemilik").value.trim();
    let jenis = document.getElementById("jenis").value.trim();
    let periode = document.getElementById("periode").value.trim();
    let deskripsi = document.getElementById("deskripsi").value.trim();
    let file = document.getElementById("foto").files[0];

    if(!nomor || !nama || !file){
        alert("Nomor, Nama, dan Foto wajib diisi!");
        return;
    }

    if(db.find(d => d.nomor === nomor)){
        alert("Nomor sudah ada!");
        return;
    }

    const reader = new FileReader();

    reader.onload = function(e){

        db.push({
            nomor: nomor,
            nama: nama,
            pemilik: pemilik,
            jenis: jenis,
            periode: periode,
            deskripsi: deskripsi,
            foto: e.target.result
        });

        setDB(db);
        tampilkanData();

        alert("Data berhasil disimpan!");

        document.getElementById("nomor").value="";
        document.getElementById("nama").value="";
        document.getElementById("pemilik").value="";
        document.getElementById("jenis").value="";
        document.getElementById("periode").value="";
        document.getElementById("deskripsi").value="";
        document.getElementById("foto").value="";
        document.getElementById("preview").innerHTML="";
    };

    reader.readAsDataURL(file);
}

//////////////////////////////////////////////////
// TAMPILKAN DATA
//////////////////////////////////////////////////

function tampilkanData(){

    let db = getDB();
    let container = document.getElementById("daftarKoleksi");
    container.innerHTML = "<h3>Daftar Koleksi</h3>";

    if(db.length===0){
        container.innerHTML += "<p>Belum ada koleksi.</p>";
        return;
    }

    db.forEach((item,index)=>{
        container.innerHTML += `
        <div class="item">
            <div class="flex">
                <img src="${item.foto}">
                <div>
                    <strong>${item.nama}</strong><br>
                    Pemilik: ${item.pemilik || "-"}<br>
                    Jenis: ${item.jenis || "-"}
                </div>
                <button class="hapus" onclick="hapus(${index})">Hapus</button>
            </div>
        </div>
        `;
    });
}

//////////////////////////////////////////////////
// HAPUS DATA
//////////////////////////////////////////////////

function hapus(index){
    let db = getDB();
    if(confirm("Yakin ingin menghapus koleksi ini?")){
        db.splice(index,1);
        setDB(db);
        tampilkanData();
    }
}

//////////////////////////////////////////////////
// LOGOUT (AMAN - DATA TIDAK HILANG)
//////////////////////////////////////////////////

function logout(){
    localStorage.removeItem("adminLogin");
    window.location.replace("index.html");
}

tampilkanData();

</script>

</body>
</html>
