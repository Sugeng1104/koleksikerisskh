<!DOCTYPE html>
<html>
<head>
  <title>Login Panel SKH</title>
  <style>
    body{
      background:black;
      color:#00ffcc;
      display:flex;
      justify-content:center;
      align-items:center;
      height:100vh;
      font-family:Arial;
    }
    .login-box{
      background:#111;
      padding:30px;
      border-radius:10px;
      width:330px;
    }
    input, select{
      width:100%;
      padding:10px;
      margin:10px 0;
      background:#222;
      border:1px solid #00ffcc;
      color:white;
    }
    button{
      width:100%;
      padding:10px;
      background:#00ffcc;
      border:none;
      cursor:pointer;
      font-weight:bold;
      margin-top:5px;
    }
    .btn-cancel{
      background:#444;
      color:white;
    }
  </style>
</head>
<body>

<div class="login-box">
  <h2>Login Panel</h2>

  <input type="text" id="username" placeholder="Username" autocomplete="username">
  <input type="password" id="password" placeholder="Password" autocomplete="current-password">

  <!-- ROLE DIPINDAH KE BAWAH PASSWORD -->
  <select id="role">
    <option value="">-- Pilih Role --</option>
    <option value="Super Admin">Super Admin</option>
    <option value="Admin">Admin</option>
    <option value="Anggota">Anggota</option>
  </select>

  <button onclick="login()">Login</button>
  <button class="btn-cancel" onclick="batal()">Batal</button>
</div>

<script>

const WEB_APP_URL = "https://script.google.com/macros/s/AKfycbxgBRf27sB3bMFNTTTfJ6ZGBAGe2xJ0Wn1cln5afaeUSL3Wcm4HMqHeSJFBU3yK60ik6A/exec";

/* ==============================
   MASTER ACCOUNT
============================== */
const masterAccounts = [
  { role:"Super Admin", username:"Sugeng11", password:"123@Sugeng" },
  { role:"Admin", username:"Admin", password:"admin1" }
];

async function login(){

  const username = document.getElementById("username").value.trim();
  const password = document.getElementById("password").value.trim();
  const role = document.getElementById("role").value.trim();

  if(!username || !password || !role){
    return alert("Lengkapi semua data!");
  }

  /* ===== CEK MASTER ACCOUNT ===== */
  const master = masterAccounts.find(acc =>
    acc.role === role &&
    acc.username === username &&
    acc.password === password
  );

  if(master){
    return setSession(username, role);
  }

  /* ===== CEK KE SPREADSHEET USERS ===== */
  const formData = new URLSearchParams();
  formData.append("action","login");
  formData.append("username",username);
  formData.append("password",password);

  try{

    const res = await fetch(WEB_APP_URL,{
      method:"POST",
      body:formData
    });

    const result = await res.json();

    if(result.status === "success"){
      
      // Pastikan role cocok dengan spreadsheet
      if(result.role !== role){
        return alert("Role tidak sesuai dengan akun.");
      }

      if(result.statusUser && result.statusUser !== "Aktif"){
        return alert("Akun belum aktif.");
      }

      setSession(result.username, result.role);

    }else{
      alert("Login gagal! Username / Password salah.");
    }

  }catch(err){
    alert("Gagal terhubung ke server.");
  }
}

function setSession(username, role){
  localStorage.setItem("isLoggedIn","true");
  localStorage.setItem("username",username);
  localStorage.setItem("role",role);
  window.location.href="dashboard-daftar-anggota.html";
}

function batal(){
  window.location.href="https://sugeng1104.github.io/koleksikerisskh/daftar-anggota.html";
}

</script>

</body>
</html>
