<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>Sertifikat Museum Nasional Digital SKH</title>

<style>
@page{
    size:A4 portrait;
    margin:0;
}
body{
    margin:0;
    font-family:Georgia,serif;
    background:#0f172a;
    display:flex;
    justify-content:center;
}
.no-print{
    position:fixed;
    top:20px;
    right:20px;
    z-index:999;
}
.no-print button{
    padding:8px 14px;
    background:gold;
    border:none;
    border-radius:6px;
    font-weight:bold;
    cursor:pointer;
    margin-left:5px;
}
.certificate{
    width:210mm;
    height:297mm;
    padding:30mm 25mm;
    box-sizing:border-box;
    border:8px double gold;
    background:linear-gradient(#111,#1e293b);
    color:white;
    position:relative;
    overflow:hidden;
}
.certificate::before{
    content: var(--wm-text,"SKH");
    position:absolute;
    font-size:180px;
    color:gold;
    opacity:0.03;
    top:40%;
    left:50%;
    transform:translate(-50%,-50%) rotate(-20deg);
    pointer-events:none;
}
.logo{text-align:center;}
.logo img{width:110px;}
.title{
    text-align:center;
    font-size:26px;
    color:gold;
    font-weight:bold;
    margin-top:10px;
}
.nama{
    text-align:center;
    font-size:30px;
    font-weight:bold;
    color:#ffd700;
    margin:15px 0;
    -webkit-text-stroke:1px black;
    text-shadow:0 0 6px black;
}
.cert-img{text-align:center;}
.cert-img img{
    max-width:240px;
    max-height:160px;
    border:3px solid gold;
    border-radius:10px;
    object-fit:contain;
}
.data{
    text-align:center;
    font-size:17px;
    margin-top:15px;
    line-height:1.8;
}
.qr{text-align:center;margin-top:25px;}
.qr img{width:120px;}
.footer{
    position:absolute;
    bottom:25mm;
    width:100%;
    text-align:center;
    font-size:13px;
    color:#ddd;
}
.signature{
    margin-top:20px;
    text-align:center;
    font-style:italic;
}
.reg{
    margin-top:10px;
    font-size:12px;
    text-align:center;
    color:#bbb;
}
@media print{
    body{background:white;}
    .no-print{display:none;}
}
</style>
</head>

<body>

<div class="no-print">
    <button onclick="window.print()">Cetak</button>
    <button onclick="window.history.back()">Kembali</button>
</div>

<div class="certificate" id="certArea">

    <div class="logo">
        <img src="logo-skh.png" onerror="this.style.display='none'">
    </div>

    <div class="title">SERTIFIKAT KOLEKSI RESMI NASIONAL</div>

    <div class="nama" id="nama"></div>

    <div class="cert-img">
        <img id="foto">
    </div>

    <div class="data">
        Nomor Sertifikat : <span id="nomor"></span><br>
        Pemilik : <span id="pemilik"></span><br>
        Jenis : <span id="jenis"></span><br>
        Periode : <span id="periode"></span><br>
        Tanggal Registrasi : <span id="tanggal"></span>
    </div>

    <div class="qr">
        <img id="qr">
        <div style="font-size:12px;margin-top:5px">
            Scan untuk verifikasi terenkripsi
        </div>
    </div>

    <div class="signature">
        Ditandatangani secara digital oleh<br>
        Kurator Nasional SKH
    </div>

    <div class="reg" id="regNumber"></div>

    <div class="footer">
        SKH Museum Nasional Digital<br>
        Sistem Registrasi & Enkripsi Resmi
    </div>

</div>

<script>

//////////////////////////////////////////////////
// API GOOGLE SHEET
//////////////////////////////////////////////////
const API_URL="https://script.google.com/macros/s/AKfycbyxp18VDz5srBz9VrCYL8MqpSTczOHqf179x83nPYg1TlHr2erB1KCLKGrglUBsDptkwA/exec";

//////////////////////////////////////////////////
// AMBIL PARAMETER
//////////////////////////////////////////////////
const params=new URLSearchParams(window.location.search);
const nomor=params.get("nomor");
const secure=params.get("secure");

if(!nomor){
    invalid("Nomor sertifikat tidak ditemukan");
}else{

fetch(API_URL+"?action=get")
.then(res=>res.json())
.then(db=>{

    let item=db.find(d=>d.nomor==nomor);

    if(!item){
        invalid("Nomor tidak terdaftar");
        return;
    }

    //////////////////////////////////////////////////
    // VALIDASI HASH (HANYA JIKA ADA PARAMETER SECURE)
    //////////////////////////////////////////////////
    if(secure){
        if(item.hash !== secure){
            invalid("URL dimanipulasi / hash tidak valid");
            return;
        }
    }

    //////////////////////////////////////////////////
    // TAMPILKAN DATA
    //////////////////////////////////////////////////
    document.getElementById("nama").innerText=item.nama || "-";
    document.getElementById("foto").src=item.foto || "";
    document.getElementById("nomor").innerText=item.nomor || "-";
    document.getElementById("pemilik").innerText=item.pemilik || "-";
    document.getElementById("jenis").innerText=item.jenis || "-";
    document.getElementById("periode").innerText=item.periode || "-";
    document.getElementById("tanggal").innerText=item.tanggal || "-";

    //////////////////////////////////////////////////
    // REGISTRASI NASIONAL
    //////////////////////////////////////////////////
    let hash=item.hash || btoa(item.nomor).substring(0,8);
    let reg="SKH-NAS-"+hash.substring(0,10).toUpperCase();

    document.getElementById("regNumber")
    .innerText="Nomor Registrasi Nasional: "+reg;

    //////////////////////////////////////////////////
    // WATERMARK DINAMIS NOMOR
    //////////////////////////////////////////////////
    document.querySelector(".certificate").style.setProperty(
        "--wm-text",
        `"SKH-${item.nomor}"`
    );

    //////////////////////////////////////////////////
    // QR ELITE (pakai hash resmi)
    //////////////////////////////////////////////////
    let verifyURL=
        window.location.origin+
        window.location.pathname+
        "?nomor="+encodeURIComponent(item.nomor)+
        "&secure="+encodeURIComponent(hash);

    let qrURL=
    "https://api.qrserver.com/v1/create-qr-code/?size=150x150&data="
    +encodeURIComponent(verifyURL);

    document.getElementById("qr").src=qrURL;

})
.catch(()=>{
    invalid("Gagal terhubung ke server");
});

}

//////////////////////////////////////////////////
// INVALID HANDLER
//////////////////////////////////////////////////
function invalid(pesan){
    document.getElementById("certArea").innerHTML=
    "<h2 style='color:red;text-align:center'>Sertifikat Tidak Valid</h2>"+
    "<p style='text-align:center'>"+pesan+"</p>";
}

</script>

</body>
</html>
