<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Admin Panel</title>

<style>
body{font-family:Arial;margin:20px;background:#f5f5f5}
h2{margin-top:40px}
table{border-collapse:collapse;width:100%;background:white}
th,td{border:1px solid #ddd;padding:8px;text-align:left}
th{background:#007bff;color:white}
button{padding:6px 10px;margin:2px;border:none;border-radius:4px;cursor:pointer}
.edit{background:orange;color:white}
.delete{background:red;color:white}
.save{background:green;color:white}
.back{background:#444;color:white;margin-top:20px}
</style>
</head>
<body>

<h1>ADMIN SKH</h1>

<h2>Daftar Anggota</h2>
<table>
<thead>
<tr>
<th>No Anggota</th>
<th>Nama</th>
<th>Status</th>
<th>Aksi</th>
</tr>
</thead>
<tbody id="anggotaTable"></tbody>
</table>

<button class="back" onclick="window.location.href='index.html'">Kembali ke Halaman Depan</button>

<script>
const WEB_APP_URL = "https://script.google.com/macros/s/AKfycbyPgjLBrypb4XYa8BnQs-mm7NtevJoDGCadCBhDvImoZUSo2AGHX0dND8ShvKA0njVg/exec";

/* ================= LOAD DATA ================= */
async function loadAnggota(){
  const res = await fetch(WEB_APP_URL);
  const data = await res.json();

  const tbody = document.getElementById("anggotaTable");
  tbody.innerHTML = "";

  data.forEach(row=>{
    const tr = document.createElement("tr");

    tr.innerHTML = `
      <td>${row["No Anggota"]}</td>
      <td>${row["Nama Lengkap"]}</td>
      <td>
        <select onchange="updateStatus('${row["No Anggota"]}',this.value)">
          <option value="Aktif" ${row.Status==="Aktif"?"selected":""}>Aktif</option>
          <option value="Tidak Aktif" ${row.Status==="Tidak Aktif"?"selected":""}>Tidak Aktif</option>
        </select>
      </td>
      <td>
        <button class="delete" onclick="hapusAnggota('${row["No Anggota"]}',this)">Hapus</button>
      </td>
    `;

    tbody.appendChild(tr);
  });
}

/* ================= UPDATE STATUS ================= */
async function updateStatus(noAnggota,status){

  await fetch(WEB_APP_URL,{
    method:"POST",
    body:JSON.stringify({
      action:"updateStatus",
      noAnggota:noAnggota,
      status:status
    })
  });

  alert("Status berhasil diperbarui");
}

/* ================= HAPUS ================= */
async function hapusAnggota(noAnggota,btn){

  if(!confirm("Yakin ingin menghapus anggota ini?")) return;

  const res = await fetch(WEB_APP_URL,{
    method:"POST",
    body:JSON.stringify({
      action:"delete",
      noAnggota:noAnggota
    })
  });

  const result = await res.json();

  if(result.status === "success"){
    btn.closest("tr").remove();
    alert("Anggota berhasil dihapus");
  }else{
    alert("Gagal menghapus: "+result.message);
  }
}

/* ================= START ================= */
loadAnggota();
</script>

</body>
</html>
