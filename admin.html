<!DOCTYPE html>
<html>
<head>
<title>Dashboard Admin SKH</title>
<style>
body{
  margin:0;
  background:linear-gradient(to right,black,#001f1f);
  color:#00ffcc;
  font-family:Arial;
}
.sidebar{
  width:220px;
  height:100vh;
  background:black;
  position:fixed;
  padding:20px;
}
.sidebar button{
  width:100%;
  padding:10px;
  margin-top:10px;
  background:#00ffcc;
  border:none;
  cursor:pointer;
}
.content{
  margin-left:240px;
  padding:30px;
}
.card{
  background:#111;
  padding:20px;
  border-radius:10px;
  margin-bottom:20px;
}
table{
  width:100%;
  margin-top:15px;
  border-collapse:collapse;
}
th,td{
  padding:10px;
  border-bottom:1px solid #333;
}
.stat-box{
  font-size:18px;
  margin-bottom:10px;
}
.logout-btn{
  background:red !important;
  color:white;
}
</style>
</head>
<body>

<div class="sidebar">
  <h2>ADMIN PANEL</h2>
  <p id="userInfo"></p>
  <p id="roleInfo"></p>

  <button onclick="window.location.href='index.html'">
    Halaman Depan
  </button>

  <button id="menuSuper" style="display:none;"
          onclick="alert('Menu khusus Super Admin')">
    Kelola Akun
  </button>

  <button class="logout-btn" onclick="logout()">
    Logout
  </button>
</div>

<div class="content">
  <h1>Dashboard Admin SKH</h1>

  <div class="card">
    <h2>Statistik Anggota</h2>
    <div class="stat-box">
      Total Anggota: <strong id="totalAnggota">0</strong>
    </div>
    <div class="stat-box">
      Aktif: <strong id="totalAktif">0</strong>
    </div>
    <div class="stat-box">
      Nonaktif: <strong id="totalNonaktif">0</strong>
    </div>
  </div>

  <div class="card">
    <h2>Daftar Anggota</h2>

    <table>
      <thead>
        <tr>
          <th>No Anggota</th>
          <th>Nama</th>
          <th>Status</th>
        </tr>
      </thead>
      <tbody id="tabelAnggota">
        <tr><td colspan="3">Memuat...</td></tr>
      </tbody>
    </table>
  </div>

</div>

<script>

const WEB_APP_URL = "https://script.google.com/macros/s/AKfycbxgBRf27sB3bMFNTTTfJ6ZGBAGe2xJ0Wn1cln5afaeUSL3Wcm4HMqHeSJFBU3yK60ik6A/exec";

//////////////////////////////////////////////////
// CEK LOGIN
//////////////////////////////////////////////////

if(localStorage.getItem("isLoggedIn") !== "true"){
  window.location.href="login.html";
}

const username = localStorage.getItem("username");
const role = localStorage.getItem("role");

document.getElementById("userInfo").innerText="User: "+username;
document.getElementById("roleInfo").innerText="Role: "+role;

if(role === "Super Admin"){
  document.getElementById("menuSuper").style.display="block";
}

function logout(){
  localStorage.clear();
  window.location.href="login.html";
}

//////////////////////////////////////////////////
// LOAD DATA ANGGOTA
//////////////////////////////////////////////////

let allData=[];

async function loadAnggota(){
  try{
    const res = await fetch(WEB_APP_URL);
    const data = await res.json();
    allData = data || [];

    updateStatistik();
    renderTabel();

  }catch(err){
    document.getElementById("tabelAnggota").innerHTML =
    "<tr><td colspan='3'>Gagal memuat data</td></tr>";
  }
}

function updateStatistik(){
  const total = allData.length;
  const aktif = allData.filter(a=>a.Status==="Aktif").length;
  const nonaktif = total - aktif;

  document.getElementById("totalAnggota").innerText=total;
  document.getElementById("totalAktif").innerText=aktif;
  document.getElementById("totalNonaktif").innerText=nonaktif;
}

function renderTabel(){

  let html="";

  allData.forEach(row=>{
    html+=`
      <tr>
        <td>${row["No Anggota"]||"-"}</td>
        <td>${row["Nama Lengkap"]||"-"}</td>
        <td>${row.Status||"Nonaktif"}</td>
      </tr>
    `;
  });

  document.getElementById("tabelAnggota").innerHTML =
    allData.length ? html :
    "<tr><td colspan='3'>Belum ada anggota</td></tr>";
}

loadAnggota();

</script>

</body>
</html>
