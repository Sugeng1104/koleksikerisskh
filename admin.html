<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Koleksi Keris SKH â€“ Arsip Resmi</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
<style>
body{font-family:Georgia,serif;background:#0f172a;color:#f1f5f9;margin:0;padding:20px}
h1{text-align:center;letter-spacing:2px}
.card{background:#1e293b;padding:25px;border-radius:14px;margin-bottom:20px;box-shadow:0 6px 20px rgba(0,0,0,0.4)}
input,textarea{width:100%;padding:10px;margin:6px 0;border-radius:8px;border:none}
button{padding:10px 18px;border:none;border-radius:8px;background:#d4af37;color:black;font-weight:bold;cursor:pointer}
.certificate{border:4px double #d4af37;padding:30px;margin-top:20px;position:relative}
.watermark{position:absolute;top:40%;left:20%;font-size:100px;opacity:0.05;transform:rotate(-25deg)}
.hash{font-size:12px;color:#cbd5e1;margin-top:15px}
</style>
</head>
<body>

<h1>ARSIP RESMI KOLEKSI KERIS SKH</h1>

<div class="card">
<h3>Tambah Koleksi (Admin Lokal)</h3>
<input id="nomor" placeholder="Nomor Sertifikat">
<input id="nama" placeholder="Nama Pusaka">
<input id="jenis" placeholder="Jenis">
<input id="periode" placeholder="Periode">
<textarea id="deskripsi" placeholder="Deskripsi"></textarea>
<button onclick="simpan()">Simpan</button>
</div>

<div class="card">
<h3>Verifikasi Publik</h3>
<input id="cari" placeholder="Masukkan Nomor Sertifikat">
<button onclick="verifikasi()">Verifikasi</button>
<div id="hasil"></div>
</div>

<script>
const secretKey="SKH2026BLOCK";

function getDB(){
 return JSON.parse(localStorage.getItem("koleksiSKH")||"[]");
}

function setDB(data){
 localStorage.setItem("koleksiSKH",JSON.stringify(data));
}

async function generateHash(text){
 const encoder=new TextEncoder();
 const data=encoder.encode(text);
 const hashBuffer=await crypto.subtle.digest("SHA-256",data);
 const hashArray=Array.from(new Uint8Array(hashBuffer));
 return hashArray.map(b=>b.toString(16).padStart(2,"0")).join("");
}

async function simpan(){
 let db=getDB();
 let nomor=document.getElementById("nomor").value;
 let nama=document.getElementById("nama").value;
 let jenis=document.getElementById("jenis").value;
 let periode=document.getElementById("periode").value;
 let deskripsi=document.getElementById("deskripsi").value;

 if(db.find(d=>d.nomor===nomor)){
  alert("Nomor sudah ada!");
  return;
 }

 let hash=await generateHash(nomor+nama+secretKey);

 db.push({nomor,nama,jenis,periode,deskripsi,hash});
 setDB(db);
 alert("Data tersimpan");
}

function verifikasi(){
 let db=getDB();
 let nomor=document.getElementById("cari").value;
 let data=db.find(d=>d.nomor===nomor);
 let hasil=document.getElementById("hasil");
 hasil.innerHTML="";

 if(!data){
  hasil.innerHTML="<p style='color:red'><b>TIDAK VALID</b></p>";
  return;
 }

 hasil.innerHTML=`
 <div class='certificate'>
 <div class='watermark'>KERIS</div>
 <h2>SERTIFIKAT AUTENTIKASI</h2>
 <b>Status:</b> VALID<br><br>
 <b>Nomor:</b> ${data.nomor}<br>
 <b>Nama:</b> ${data.nama}<br>
 <b>Jenis:</b> ${data.jenis}<br>
 <b>Periode:</b> ${data.periode}<br><br>
 <b>Deskripsi:</b><br>${data.deskripsi}<br><br>
 <div id='qr'></div>
 <div class='hash'>Digital Hash:<br>${data.hash}</div>
 <br><button onclick='window.print()'>Cetak / Simpan PDF</button>
 </div>
 `;

 new QRCode(document.getElementById("qr"),{
  text: window.location.href.split("?")[0]+"?verify="+data.nomor,
  width:120,height:120
 });
}

// Auto verify via URL
window.onload=function(){
 const params=new URLSearchParams(window.location.search);
 if(params.get("verify")){
  document.getElementById("cari").value=params.get("verify");
  verifikasi();
 }
}
</script>

</body>
</html>
