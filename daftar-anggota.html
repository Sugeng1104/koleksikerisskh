<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Daftar Anggota</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>

<body>

<h2>Form Pendaftaran Anggota</h2>

<form id="formDaftar">
  <label>Nama Lengkap</label><br>
  <input type="text" id="nama" required><br><br>

  <label>Gelar</label><br>
  <input type="text" id="gelar"><br><br>

  <label>Alamat</label><br>
  <textarea id="alamat"></textarea><br><br>

  <label>No HP</label><br>
  <input type="text" id="nohp"><br><br>

  <label>Foto</label><br>
  <input type="file" id="foto" accept="image/*"><br><br>

  <button type="submit">Daftar</button>
</form>

<p id="status"></p>

<script>

const SCRIPT_URL = "PASTE_URL_WEB_APP_KAMU_DI_SINI";

const MAX_WIDTH = 800;
const JPEG_QUALITY = 0.7;

/* ================= RESIZE IMAGE ================= */
async function resizeImage(file) {
  return new Promise((resolve) => {

    const reader = new FileReader();

    reader.onload = function(e) {

      const img = new Image();
      img.onload = function() {

        let width = img.width;
        let height = img.height;

        if (width > MAX_WIDTH) {
          const ratio = MAX_WIDTH / width;
          width = MAX_WIDTH;
          height = height * ratio;
        }

        const canvas = document.createElement("canvas");
        canvas.width = width;
        canvas.height = height;

        const ctx = canvas.getContext("2d");
        ctx.drawImage(img, 0, 0, width, height);

        const base64 = canvas.toDataURL("image/jpeg", JPEG_QUALITY);

        resolve(base64);
      };

      img.src = e.target.result;
    };

    reader.readAsDataURL(file);
  });
}

/* ================= SUBMIT FORM ================= */
document.getElementById("formDaftar").addEventListener("submit", async function(e){

  e.preventDefault();

  const statusText = document.getElementById("status");
  statusText.innerText = "Mengupload...";

  const nama = document.getElementById("nama").value;
  const gelar = document.getElementById("gelar").value;
  const alamat = document.getElementById("alamat").value;
  const nohp = document.getElementById("nohp").value;

  const file = document.getElementById("foto").files[0];

  let base64Image = "";

  if(file){
    base64Image = await resizeImage(file);
  }

  try{

    const response = await fetch(SCRIPT_URL, {
      method: "POST",
      body: JSON.stringify({
        action: "add",
        nama: nama,
        gelar: gelar,
        alamat: alamat,
        nohp: nohp,
        foto: base64Image,
        mimeType: "image/jpeg"
      })
    });

    const result = await response.json();

    if(result.status === "success"){
      statusText.innerText = "Pendaftaran berhasil!";
      document.getElementById("formDaftar").reset();
    }else{
      statusText.innerText = "Gagal: " + result.message;
    }

  }catch(error){
    statusText.innerText = "Terjadi kesalahan koneksi.";
  }

});

</script>

</body>
</html>
